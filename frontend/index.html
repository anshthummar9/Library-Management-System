<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <h1 class="text-3xl font-bold">üìö Library Management System</h1>
            <p class="text-blue-100">Manage your library efficiently</p>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-white shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex space-x-4">
                <button onclick="showTab('books')" class="tab-btn px-6 py-4 font-semibold text-blue-600 border-b-2 border-blue-600">
                    Books
                </button>
                <button onclick="showTab('members')" class="tab-btn px-6 py-4 font-semibold text-gray-600 hover:text-blue-600">
                    Members
                </button>
                <button onclick="showTab('transactions')" class="tab-btn px-6 py-4 font-semibold text-gray-600 hover:text-blue-600">
                    Transactions
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        
        <!-- Books Tab -->
        <div id="books" class="tab-content active">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Add Book Form -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">Add New Book</h2>
                        <form id="bookForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                                <input type="text" id="bookTitle" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Author *</label>
                                <input type="text" id="bookAuthor" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ISBN *</label>
                                <input type="text" id="bookIsbn" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Publisher</label>
                                <input type="text" id="bookPublisher" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <input type="text" id="bookCategory" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Total Copies *</label>
                                <input type="number" id="bookCopies" required min="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition font-semibold">
                                Add Book
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Books List -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">All Books</h2>
                            <button onclick="loadBooks()" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition">
                                üîÑ Refresh
                            </button>
                        </div>
                        <div class="mb-4">
                            <input type="text" id="searchBooks" placeholder="Search by title or author..." class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div id="booksList" class="space-y-4 max-h-96 overflow-y-auto">
                            <p class="text-gray-500 text-center py-8">Loading books...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Members Tab -->
        <div id="members" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Add Member Form -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">Add New Member</h2>
                        <form id="memberForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                                <input type="text" id="memberName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                                <input type="email" id="memberEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                <input type="tel" id="memberPhone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                                <textarea id="memberAddress" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition font-semibold">
                                Add Member
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Members List -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">All Members</h2>
                            <button onclick="loadMembers()" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition">
                                üîÑ Refresh
                            </button>
                        </div>
                        <div id="membersList" class="space-y-4 max-h-96 overflow-y-auto">
                            <p class="text-gray-500 text-center py-8">Loading members...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Issue Book Form -->
                <div>
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">Issue Book</h2>
                        <form id="issueForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Select Book *</label>
                                <select id="issueBookId" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">-- Select Book --</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Select Member *</label>
                                <select id="issueMemberId" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">-- Select Member --</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700 transition font-semibold">
                                Issue Book
                            </button>
                        </form>
                    </div>

                    <!-- Return Book Form -->
                    <div class="bg-white rounded-lg shadow-md p-6 mt-6">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">Return Book</h2>
                        <form id="returnForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Select Transaction *</label>
                                <select id="returnTransactionId" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">-- Select Transaction --</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-orange-600 text-white py-2 rounded-md hover:bg-orange-700 transition font-semibold">
                                Return Book
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Transactions List -->
                <div>
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">All Transactions</h2>
                            <button onclick="loadTransactions()" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition">
                                üîÑ Refresh
                            </button>
                        </div>
                        <div id="transactionsList" class="space-y-4 max-h-96 overflow-y-auto">
                            <p class="text-gray-500 text-center py-8">Loading transactions...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg hidden transition-opacity">
        <p id="toastMessage"></p>
    </div>

    <script>
        // API Base URL - CHANGE THIS TO YOUR BACKEND URL
        const API_BASE_URL = 'http://localhost:8080/api';

        // Tab Navigation
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const btns = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            btns.forEach(btn => {
                btn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                btn.classList.add('text-gray-600');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.remove('text-gray-600');
            event.target.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
            
            if (tabName === 'books') loadBooks();
            if (tabName === 'members') loadMembers();
            if (tabName === 'transactions') {
                loadTransactions();
                loadBooksForDropdown();
                loadMembersForDropdown();
                loadIssuedTransactions();
            }
        }

        // Toast Notification
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg ${isError ? 'bg-red-600' : 'bg-green-600'} text-white`;
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // ===== BOOKS FUNCTIONS =====
        
        // Load all books
        async function loadBooks() {
            try {
                const response = await fetch(`${API_BASE_URL}/books`);
                const books = await response.json();
                
                const booksList = document.getElementById('booksList');
                if (books.length === 0) {
                    booksList.innerHTML = '<p class="text-gray-500 text-center py-8">No books found</p>';
                    return;
                }
                
                booksList.innerHTML = books.map(book => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-gray-800">${book.title}</h3>
                                <p class="text-gray-600">by ${book.author}</p>
                                <p class="text-sm text-gray-500 mt-1">ISBN: ${book.isbn}</p>
                                ${book.category ? `<span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mt-2">${book.category}</span>` : ''}
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-600">Available: <span class="font-bold text-green-600">${book.availableCopies}</span>/${book.totalCopies}</p>
                                <button onclick="deleteBook(${book.id})" class="mt-2 text-red-600 hover:text-red-800 text-sm font-semibold">Delete</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                showToast('Error loading books', true);
                console.error(error);
            }
        }

        // Add book
        document.getElementById('bookForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const book = {
                title: document.getElementById('bookTitle').value,
                author: document.getElementById('bookAuthor').value,
                isbn: document.getElementById('bookIsbn').value,
                publisher: document.getElementById('bookPublisher').value,
                category: document.getElementById('bookCategory').value,
                totalCopies: parseInt(document.getElementById('bookCopies').value)
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/books`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(book)
                });
                
                if (response.ok) {
                    showToast('Book added successfully!');
                    document.getElementById('bookForm').reset();
                    loadBooks();
                } else {
                    showToast('Error adding book', true);
                }
            } catch (error) {
                showToast('Error adding book', true);
                console.error(error);
            }
        });

        // Delete book
        async function deleteBook(id) {
            if (!confirm('Are you sure you want to delete this book?')) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/books/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showToast('Book deleted successfully!');
                    loadBooks();
                } else {
                    showToast('Error deleting book', true);
                }
            } catch (error) {
                showToast('Error deleting book', true);
                console.error(error);
            }
        }

        // Search books
        document.getElementById('searchBooks').addEventListener('input', async (e) => {
            const query = e.target.value.toLowerCase();
            if (query.length < 2) {
                loadBooks();
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/books/search/title?title=${query}`);
                const books = await response.json();
                
                const booksList = document.getElementById('booksList');
                booksList.innerHTML = books.map(book => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                        <h3 class="text-lg font-bold text-gray-800">${book.title}</h3>
                        <p class="text-gray-600">by ${book.author}</p>
                        <p class="text-sm text-gray-500">Available: ${book.availableCopies}/${book.totalCopies}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error(error);
            }
        });

        // ===== MEMBERS FUNCTIONS =====
        
        // Load all members
        async function loadMembers() {
            try {
                const response = await fetch(`${API_BASE_URL}/members`);
                const members = await response.json();
                
                const membersList = document.getElementById('membersList');
                if (members.length === 0) {
                    membersList.innerHTML = '<p class="text-gray-500 text-center py-8">No members found</p>';
                    return;
                }
                
                membersList.innerHTML = members.map(member => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-gray-800">${member.name}</h3>
                                <p class="text-gray-600">${member.email}</p>
                                ${member.phone ? `<p class="text-sm text-gray-500">üìû ${member.phone}</p>` : ''}
                                ${member.address ? `<p class="text-sm text-gray-500">üìç ${member.address}</p>` : ''}
                                <p class="text-xs text-gray-400 mt-2">Member since: ${new Date(member.membershipDate).toLocaleDateString()}</p>
                            </div>
                            <button onclick="deleteMember(${member.id})" class="text-red-600 hover:text-red-800 text-sm font-semibold">Delete</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                showToast('Error loading members', true);
                console.error(error);
            }
        }

        // Add member
        document.getElementById('memberForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const member = {
                name: document.getElementById('memberName').value,
                email: document.getElementById('memberEmail').value,
                phone: document.getElementById('memberPhone').value,
                address: document.getElementById('memberAddress').value
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/members`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(member)
                });
                
                if (response.ok) {
                    showToast('Member added successfully!');
                    document.getElementById('memberForm').reset();
                    loadMembers();
                } else {
                    showToast('Error adding member', true);
                }
            } catch (error) {
                showToast('Error adding member', true);
                console.error(error);
            }
        });

        // Delete member
        async function deleteMember(id) {
            if (!confirm('Are you sure you want to delete this member?')) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/members/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showToast('Member deleted successfully!');
                    loadMembers();
                } else {
                    showToast('Error deleting member', true);
                }
            } catch (error) {
                showToast('Error deleting member', true);
                console.error(error);
            }
        }

        // ===== TRANSACTIONS FUNCTIONS =====
        
        // Load books for dropdown
        async function loadBooksForDropdown() {
            try {
                const response = await fetch(`${API_BASE_URL}/books`);
                const books = await response.json();
                
                const select = document.getElementById('issueBookId');
                select.innerHTML = '<option value="">-- Select Book --</option>' + 
                    books.filter(b => b.availableCopies > 0).map(book => 
                        `<option value="${book.id}">${book.title} - ${book.author} (Available: ${book.availableCopies})</option>`
                    ).join('');
            } catch (error) {
                console.error(error);
            }
        }

        // Load members for dropdown
        async function loadMembersForDropdown() {
            try {
                const response = await fetch(`${API_BASE_URL}/members`);
                const members = await response.json();
                
                const select = document.getElementById('issueMemberId');
                select.innerHTML = '<option value="">-- Select Member --</option>' + 
                    members.map(member => 
                        `<option value="${member.id}">${member.name} (${member.email})</option>`
                    ).join('');
            } catch (error) {
                console.error(error);
            }
        }

        // Load issued transactions for return dropdown
        async function loadIssuedTransactions() {
            try {
                const response = await fetch(`${API_BASE_URL}/transactions`);
                const transactions = await response.json();
                
                const issuedTransactions = transactions.filter(t => t.status === 'ISSUED');
                
                const select = document.getElementById('returnTransactionId');
                select.innerHTML = '<option value="">-- Select Transaction --</option>' + 
                    issuedTransactions.map(t => 
                        `<option value="${t.id}">${t.book.title} - ${t.member.name} (Due: ${new Date(t.dueDate).toLocaleDateString()})</option>`
                    ).join('');
            } catch (error) {
                console.error(error);
            }
        }

        // Issue book
        document.getElementById('issueForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const bookId = document.getElementById('issueBookId').value;
            const memberId = document.getElementById('issueMemberId').value;
            
            try {
                const response = await fetch(`${API_BASE_URL}/transactions/issue?bookId=${bookId}&memberId=${memberId}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    showToast('Book issued successfully!');
                    document.getElementById('issueForm').reset();
                    loadTransactions();
                    loadBooksForDropdown();
                    loadIssuedTransactions();
                } else {
                    showToast('Error issuing book', true);
                }
            } catch (error) {
                showToast('Error issuing book', true);
                console.error(error);
            }
        });

        // Return book
        document.getElementById('returnForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const transactionId = document.getElementById('returnTransactionId').value;
            
            try {
                const response = await fetch(`${API_BASE_URL}/transactions/return/${transactionId}`, {
                    method: 'PUT'
                });
                
                if (response.ok) {
                    const transaction = await response.json();
                    const message = transaction.fine > 0 
                        ? `Book returned! Fine: $${transaction.fine.toFixed(2)}` 
                        : 'Book returned successfully!';
                    showToast(message);
                    document.getElementById('returnForm').reset();
                    loadTransactions();
                    loadBooksForDropdown();
                    loadIssuedTransactions();
                } else {
                    showToast('Error returning book', true);
                }
            } catch (error) {
                showToast('Error returning book', true);
                console.error(error);
            }
        });

        // Load all transactions
        async function loadTransactions() {
            try {
                const response = await fetch(`${API_BASE_URL}/transactions`);
                const transactions = await response.json();
                
                const transactionsList = document.getElementById('transactionsList');
                if (transactions.length === 0) {
                    transactionsList.innerHTML = '<p class="text-gray-500 text-center py-8">No transactions found</p>';
                    return;
                }
                
                transactionsList.innerHTML = transactions.map(t => {
                    const statusColor = t.status === 'ISSUED' ? 'bg-yellow-100 text-yellow-800' : 
                                       t.status === 'RETURNED' ? 'bg-green-100 text-green-800' : 
                                       'bg-red-100 text-red-800';
                    
                    return `
                        <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-lg font-bold text-gray-800">${t.book.title}</h3>
                                <span class="px-2 py-1 rounded text-xs font-semibold ${statusColor}">${t.status}</span>
                            </div>
                            <p class="text-gray-600">Member: ${t.member.name}</p>
                            <div class="text-sm text-gray-500 mt-2">
                                <p>Issue Date: ${new Date(t.issueDate).toLocaleDateString()}</p>
                                <p>Due Date: ${new Date(t.dueDate).toLocaleDateString()}</p>
                                ${t.returnDate ? `<p>Return Date: ${new Date(t.returnDate).toLocaleDateString()}</p>` : ''}
                                ${t.fine > 0 ? `<p class="text-red-600 font-semibold">Fine: $${t.fine.toFixed(2)}</p>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                showToast('Error loading transactions', true);
                console.error(error);
            }
        }

        // Initial load
        window.onload = () => {
            loadBooks();
        };
    </script>
</body>
</html>